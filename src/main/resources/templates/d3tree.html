<!DOCTYPE html>
<html>
<head>
    <title>D3 Tree</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}" href="../../css/styles.css" />
    <script th:src="@{/js/lib/jquery-3.2.0.min.js}" src="../../js/lib/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script th:src="@{/js/lib/d3.min.js}" src="../../js/lib/d3.min.js" type="text/javascript"></script>

    <script th:inline="javascript" type="text/javascript">
        $("document").ready(function (e) {
            /*<![CDATA[*/
            getDataFromWebService(/*[[@{/public/api/kmcatalogentries}]]*/);
            $('#btnToggleDocuments').click(function () {
                $('tblListData').toggle();
            });
            /*]]>*/
        });

        function getDataFromWebService(targetUrl) {
            $.ajax({
                type: "GET", //method type of GET
                url: targetUrl, //url passed to function
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data, status, jqXHR) { //on successful ajax call
                    jsonToTable(data);
                    createCustomJSON(data);
                },
                error: function (jqXHR, status) { //if not successful
                    console.log(status); //log error to javascript console
                }
            });
        }

        function createCustomJSON(json) {
            /*<![CDATA[*/

            $('#btnToggleDocuments').css('visibility', 'visible');
            /*]]>*/
        }

        function jsonToTable(json) {
            /*<![CDATA[*/
            console.log(json);
            var $table = $('#tblListData'); //create table variable from DOM table object
            $table.empty(); //clear the table
            for (var i = 0; i < json.length; i++) { //iterate through JSON array
                var $row = $('<tr />'); //create new table row
                //append JSON properties to the row's cells
                $row.append('<td>' + json[i].documentTitle + '</td>');
                $row.append('<td>' + json[i].documentCategory + '</td>');
                $row.append('<td>' + json[i].product + '</td>');
                $row.append('<td>' + json[i].community + '</td>');
                $row.append('<td>' + json[i].audience + '</td>');
                $row.append('<td>' + json[i].documentFilename + '</td>');
                $table.append($row); //append the row with values to the table
            }
            /*]]>*/
        }

    </script>
</head>
<body>
    <header>
        <h1 data-th-inline="text"><img th:src="@{/images/logo.jpg}" alt="" />Knowledge Management System</h1>
    </header>
    <section id="nav">
        <nav>
            <ul>
                <li><a th:href="@{/kmcatalogentries}">Home</a></li>
                <li><a th:href="@{/documentcategories}">Document Categories</a></li>
                <li><a th:href="@{/products}">Products</a></li>
                <li><a th:href="@{/departments}">Departments</a></li>
                <li><a th:href="@{/communities}">Communities</a></li>
                <li><a th:href="@{/d3tree}">D3 Tree</a></li>
            </ul>
        </nav>
    </section>
    <section class="content">
        <div id="treeDiv"></div>    
        <div>
            <button id="btnToggleDocuments">Toggle Document List</button>
        </div> 
        <div>
            <table id="tblListData">
                <tr>
                    <th>Title</th>
                    <th>Document Category</th>
                    <th>Product</th>
                    <th>Community</th>
                    <th>Audience</th>
                    <th>Filename</th>
                </tr>
            </table>
        </div>
    </section>
</body>
</html>